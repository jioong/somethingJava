# AWK #
  
*AWK* 程序语言的设计是为了简化一般文本处理的工作。  
  
## AWK 命令行 ##
  
*awk* 的调用可以定义变量、提供程序并且指定输入文件：  
```awk
	awk [ -F fs ] [ -v var=value ... ] 'program' [ --] \
		[ var=value ... ] [ file[s] ]  
  
	awk [ -F fs ] [ -v var=value ... ] -f programfile [ --] \
		[ var=value ... ] [ file[s] ]
```  
  
短程序通常是直接在命令行上提供，而较长的程序，则通过 `-f` 选项指定。遇到需连接被指名的程序文件以得到完整的程序时，则可重复使用此选项。  
如果命令行没有指定文件名，则 `awk` 读取标注输入。  
`--` 是特殊选项：指出 `awk` 本身已没有更进一步的命令行选项。任何接下来的选项都可以被该程序使用。  
`-F` 选项是用来重新定义默认字段分隔符，一般惯例将其作为第一个命令行选项。紧接在 `-F` 选项后的 `fs` 参数是一个正则表达式，或是被提供作为下一个参数。字段分隔符也可是指使用 **内建变量 FS** 所指定的。  
  
## AWK 程序模型 ##
  
> *awk* 把输入流看做一连串记录的集合，每条记录都可进一步细分为字段。通常，一行一条记录，而字段则由一个或多个非空白字符的单词组成。  

注意：是什么构成一条记录和一个字段，完全是由程序员控制的，其 **它们的定义，甚至可以在处理期间更改。**  
  
一个 `awk` 程序是一对以 **模式** 与大括号框起来的 **操作** 组合而成的。还可以加上实现操作细节的 **函数** 。针对每个匹配与输入数据的模式，操作会被执行，且所有模式都会 **针对每条输入记录** 而检查。  
模式和操作可以省略其中一个。如果模式省略，则操作将会被应用到每条输入记录；如果操作被省略，则默认操作为将匹配的记录打印到标准输出。如下：  
```awk
	pattern { action }				// 如果模式匹配，则执行操作
	pattern							// 如果模式匹配，则打印记录
			{ action } 				// 针对每条记录，执行操作  
```  
输入会自动地由一个输入文件切换到下一个输入文件，且 `awk` 本身通常会处理每个输入文件的打开、读取和关闭，以允许用户程序专心致力于 **记录的处理。**  
模式多半是数字或字符串表达式，但是 `awk` 通过保留字 `BEGIN` 和 `END` 提供两种特殊的模式。  
* 与 `BEGIN` 关联的操作只会执行一次，在任何命令行文件或一般命令行赋值被处理之前，但是在任何开头的 `-v` 选项指定已经完成之后。它大多用于处理程序所需要的任何特殊初始化工作。  
* `END` 操作也是只执行一次，用于所有输入数据已被处理完之后。它多半用于产生摘要报告，或是执行清除操作。  
* `BEGIN, END` 模式可以是任意顺序的，可以存在于 `awk` 程序内的任何位置。为了方便，通常将 `BEGIN` 模式放在程序的第一个位置，而将 `END` 模式放在最后。  
* 当指定多个 `BEGIN, END` 模式时，将被按照在 `awk` 程序里的顺序，一次执行。  

## 程序元素 ##
  
`awk` 提供标量和数组两种变量来保存数据、数字和字符串，还提供一些语句类型用于处理数据：赋值、注释、条件、函数、输入、循环和输出。  
  
### 注释与空白 ###
  
`awk` 的注释从 `#` 开始到该行结束。  
语言里的任何地方都能有空白，也允许使用任何长度的空白字符。通过适当的使用空行与缩进，可以增进程序的可读性。  
单条语句通常不能被分割跨越多行，除非在行切割的地方立即前置一个反斜杠。   
  
### 字符串与字符串表达式 ###
  
`awk` 里的字符串常数以引号定界。字符串可以包含任何 *8-bit* 的字符，除了控制字符 *NUL* 以外。`awk` 字符串包含零至多个字符，且在字符串的长度上没有限制，视可用内存而定。字符串表达式赋值给变量后，会自动建立一个字符串，且变量的前一个字符串值所占用的内存也会被自动回收。  
反斜杠转义序列允许非打印字符的表示。  
`awk` 提供了许多方便好用的 **内建函数**，可在字符串上执行。  
字符串的比较，用得上传统的关系运算符: `==, !=, <, <=, >, >=` 。比较后返回 1 为真， 0 为假。比较不同长度的字符串，且其中一个字符串为另一个的初始子字符串时，较短的会定义为小于较长的那个。  
不同于大多数程序语言用于字符串数据类型：`awk` 并无特殊的字符串接续运算符。也就是说，两个连续字符串，会自动连接在一起。  
将数字转换为字符串，通过数字连接空字符串即可: `n = 123; s = "" n`, 把 123“ 赋给 `s`。当数字无法确切地表示时，会出现一些警告。  
`awk` 功能强大的地方大多来自于它对正则表达式的支持。有两个运算符 `~（匹配）` 与 `!~（不匹配）` 。  
  
### 数字与数值表达式 ###
  
所有 `awk` 里的数字，都以双精度的浮点值表示。浮点数可以包含一个末端以字母 *e,E* 所表示的 10 次方指数以及可选地带正负号的一个整数。`awk` 将字符串转换为数字：只要加个零到字符串里。例如：`s = "1234"` ,接着是 `n = 0 + s`，便将数字 1234 赋给 `n` 了。  
浮点数有精度限制，有些值无法准确表示：计算的次序很重要，且计算的结果通常只是尽可能地表示为最接近的数字。  
  
**awk 的数值运算符(优先级由大到小)**  
![数值运算符](./images/awk_operator.png "数值运算符")  
  
### 标量变量 ###