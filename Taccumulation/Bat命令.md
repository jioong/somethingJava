# BAT #
  
## 基础语法 ##
  
1. 批处理文件是一个 `.bat` 文件，文件的每一行都是一条 `DOS` 命令。可以使用任何文本编辑工具创建和修改。  
2. 批处理可以有逻辑结构，使用 `if, goto` 控制程序流，使用 `for` 实现循环。  
3. 可以将批处理文件所在路径放入 `PATH` 路径，则可在任意位置运行。  
4. `C:\AUTOEXEC.BAT` 是每次系统启动时自动运行。  
5. 大小写不敏感。  
  
## 参数 ##
  
### 系统参数 ###
  
* %SystemRoot% --- `C:\WINDOWS`  
* ...  

```Bat
	:: 枚举当前环境变量
	setlocal enabledelayedexpansion
       FOR /F "usebackq delims==" %%i IN (`set`) DO @echo %%i    !%%i!
```  
  
### 传递参数给批处理文件 ###
  
`%[1-9]` 表示参数，参数是指在运行批处理文件时在文件名后的字符串。变量从 `%0` 到 `%9`，其中 `%0` 表示批处理命令本身，其他参数字符串用 `%1 -- %9` 表示。  
  
## 批处理基本命令 ##
  
### 1. help ###
  
作用：显示命令的帮组信息。用法：  
` command /?` 或者 `help command`  
  
### 2. echo ###
  
用法：`echo [on|off] [message]`  
`echo [on|off]`   --- 打开回显或关闭回显。  
`echo`   --- 显示当前回显设置。  
`echo message`   --- 显示信息。  
`echo off`   --- 表示此语句后的所有运行的命令都不显示命令行本身。即不会有提示出现。  
  
### 3. @ ###
  
作用：不显示 `@` 后面的命令。  
它与 `echo off` 类似，但是它加在每个命令行的最前面，表示运行时不显示这一行的命令行，**只影响当前行。**  
  
### 4. goto ###
  
语法：`goto label`,其中 `label` 是参数，指定所要转向的批处理程序中的行。  
跳转到指定标签行，找到标签行后，程序将从下一行开始处理命令。  
`label` 标签的名字可以随便取，字母前必须加上冒号 `:` 来表示该字母是标签。  
`goto` 命令根据该冒号来寻找下一步跳转到那里。常与 `if` 配合适应。    
  
### 5. rem ###
  
语法：`rem message...` ,可以使用 `::` 代替 `rem` 。  
作用：注释。  
  
### 6. pause ###
  
作用：暂停批处理的执行，并在屏幕上显示 `press any key to cintinue...` 的提示，等待用户按下任意键后继续。  
可用于保留批处理的执行窗口。  
  
### 7. call ###
  
语法：`call [[Driver:][Path] FileName [BatchParameters]] [:label [arguments]]`  
参数：`[Driver:][Path] FileName` 指定要调用的批处理程序的位置和名称，其中 `FileName` 参数是必须以 `.bat, .cmd` 扩展名。  
调用另外的批处理程序，且不会终止父批处理程序。如果不使用 `call` 而直接调用别的批处理文件，那么执行完哪个批处理文件后将无法返回当前文件并执行当前文件的后续命令。  
`call` 命令可以调用作为调用目标的 **标签**。如果在脚本会批处理文件外使用 `call`，它将不会在命令行起作用。  
  
### 8. start ###
  
作用：调用外部程序，所有的`DOS`命令和命令行程序都可以由 `start` 命令来调用。  
常用参数：  
* `MIN` --- 开始时窗口最小化。  
* `SEPARATE` --- 在分开的空间内开始 16 位 *Windows* 程序。  
* `HIGH` --- 在 *HIGH* 优先级类别开始应用程序。  
* `REALTIME` --- 在 *REALTIME* 优先级类别开始应用程序。  
* `WAIT` --- 启动应用程序并等待它结束。  
* `parameters` --- 传递到命令的参数。  

### 9. if ###
  
`if` 表示将判断是否符合规定的条件，从而决定执行不同的命令。有三种格式：  
1. `if`  
语法：`if [not] "参数“ == "字符串" 待执行的命令`  
参数如果等于(not 表示不等于)指定的字符串，则条件成立，运行命令。否则， 执行下一句。  
  
2. `if exist`  
语法：`if [not] exist [路径\]文件名  待执行的命令`  
如果有指定的文件，则条件成立。  
  
3. `if errorlevel number`  
语法：`if [not] errorlevel <数字> 待执行的命令`  
如果程序返回值等于指定的数字，则条件成立。**返回值必须按照从大到小顺序排列。**  
这里的`errorlevel` 是在程序运行结束后返回的一个数值，用来表示程序运行的结果，称为错误码或返回码。  
  
4. `else`  
语法：`if 条件 (成立时执行的命令) else (不成立时执行的命令)`  
如果是多个条件，可使用括号把各条件包起来。  
**如果 else 的语句需要换行， if执行的行尾需要用 "^" 连接，并且 if 执行的动作需要用圆括号括起来。**  
```Bat
	if 1 == 0 (echo comment1) ^
	else (echo comment2)
```
  
5. 比较运算符  
	* `EQU` --- 等于 ==  
	* `NEQ` --- 不等于，没有 !=  
	* `LSS` --- 小于  
	* `LEQ` --- 小于或等于  
	* `GTR` --- 大于  
	* `GEQ` --- 大于或等于  

### 10. choice ###
  
作用：`choice` 可以让用户输入一个字符，用于选择，从而根据用户的选择返回不同的 `errorlevel`。该命令为*DOS* 系统提供的外部命令。  
`choice` 可以让用户输入 **一个字符**，从而运行不同的命令。  
  
### 11. for ###
  
`for` 主要用于参数在指定的范围内循环执行命令。  
1. `for {%variable | %%variable} in (set) do command [command-parameters]`,其中  
	* `%variable` 制定法一个单一字母可替换的参数。便令名称是区分大小写的。  
	* 在批处理文件中使用 `FOR` 命令时，指定变量建议使用 `%%variable` 而不是 `%variable` 。  
	* `(set)` 指定一个或一组文件，可以使用通配符。  
	* `command` 指定对每个文件执行的命令。  
	* `command-parameters` 为特定命令指定参数或命令行开关。  

2. 如果命令扩展名被启用，下列额外的 `FOR` 命令格式会受到支持：  
	* `for /D %variable in (set) do command [command-parameters]`，如果`set`里包含通配符，则指定与目录名匹配，而不是与文件名匹配。  
	* `for /R [[drive:]path] %variable in (set) do command [command-parameters]`，检查以`[driver:]path` 为根的目录树，指向每个目录中的 `for` 语句。如果 `/R` 后没有指定目录，则使用当前目录。如果`set`中仅有一个单点 `.` 字符，则枚举该目录树。  

  
### continue 和 break ###
  
利用 `goto` 实现程序中常用的 `continue, break` 命令。  
`continue` 在 `for` 循环的最后一行写上一个标签，跳转到这个位置即可。  
`break` 在 `for` 循环的外面的下一句写上一个标签，跳转到这个位置即可。   
```Bat
	for /F ["options"] %variable in (command) do (
		... do command ...
	if ... goto continue
	if ... goto break
	... do command ...
	:continue
	)
	:break
```  
  
## 其他命令 ##
  
### 1. ping ###
  
作用：测试网络联接状况以及信息包发送和接受情况。**但是不能够测试端口。**  
语法：`pint ip地址或主机名 [-t] [-a] [-n count] [-l size]`  
其中，`-t` 表示不停向目标主机发送数据。  
`-a` 表示以 `IP` 地址格式来显示目标主机的网络地址。   
`-n count` 指定要 `ping` 多少次，具体次数由 `count` 指定。  
`-l size` 指定要发送方到目标主机的数据包的大小。  
  
### 2. telnet ###
  
作用：测试端口使用 `telnet Ip地址或主机名 port`,使用的是`tcp`协议。  
  
### 3. color ###
  
作用：设置背景及字体颜色。  
语法： `clolor bf`  
其中，`b`是指定背景色的十六进制数，`f`指定前景颜色（即字体颜色）。  
颜色值： 0：黑色，1：蓝色，2：绿色，3：湖蓝，4：红色，5：紫色，6：黄色，7：白色，8：灰色，9：淡蓝，A:淡绿，B：浅绿，C：淡红，D：淡紫，E:淡黄，F:亮白  
如果不指定任何参数，该命令将颜色还原到 `CMD.EXE` 启动时的颜色。  
如果两参数一样，视为无效输入。只有一个参数时，设置字体。  
  
### 4. exit ###
  
结束程序。即使是被调用的程序，结束后也不会返回原程序。  
  
### 5. shutdown ###
  
`shutdown -s` 关机。  
  
## 字符串处理 ##
  
1. 分割字符串。`%源字符串:~起始值,截取长度%`,其中起始值从 0 开始，截取长度是可选的。如果省略逗号和截取长度，将会从起始值截取到结尾。截取长度如果是负值，表示截取到倒数第几个。  
2. 替换字符串。`%源字符串:待替换字符串=替换字符串`。  
3. 字符串合并。`%str1%%str2%` 。  

## 文件处理 ##
  
1. 删除。  
	1. 删除一个或多个文件。`del /s /q /f d:\test\a.txt` 将直接删除指定文件，没有任务提示。`del temp\* /q /f /s` 将直接删除本目录下的`temp`目录下是所有文件，没有任务提示。  
	2. 删除一个空目录。`rd /q /s D;\test\log` 将直接删除指定目录，如果目录不为空将无法删除。  
	3. 删除一个非空目录。`rmdir /q /s d:\test\log` 必须指定目录名称，**不能使用通配符。**  
  
2. 创建目录。`mkdir [drive:]path` 或者 `md [drive:]path` 路径有空格时，可以使用双引号括起来，也可以使用 `&nbsp;` 替代。  
  
## 其他 ##
  
1. 调用其他程序时，对文件的大小写不敏感，文件后缀名也可以忽略。  
2. `>` 覆盖， `>>` 追加。  
3. 在命令末尾加上 `>NUL 2>NUL`,表示隐蔽返回信息。  
4. 等待用户输入。`set /p 变量名=屏幕显示信息`。  
5. `pause` 等待用户回车退出。  
6. 设置标题：`title 标题`。  
7. 清屏：`cls`。  
8. 共享：  
	1. 查看机器的共享资源：`net share`。  
	2. 手工删除共享：`net share 共享资源名称 /d`。 
	3. 增加一个共享:`net share name=path /users:3`。限制连接用户人数为 3 人。 



**参考资料：**[Bat学习](http://www.cnblogs.com/SunShineYPH/archive/2011/12/13/2285570.html)