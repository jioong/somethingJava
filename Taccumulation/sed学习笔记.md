2015/1/25 星期日 10:31:27 

# Sed 学习笔记 #

## 1. Sed 简介 ##

*Sed* 是一种**在线**编辑器，它一次处理一行内容。处理时，把当前处理的行存储在临时缓冲区中，称为“模式空间”(pattern space)，接着用*sed*命令处理 缓冲区中的内容，处理完后，把缓冲区的内容送往屏幕。接着处理下一行，这样不断重复，直到文件末尾。  
文件内容并没有改变，除非你使用重定向存储输出。  
*Sed* 主要用来自动编辑一个或多个文件；简化对文件的反复操作；编写转换程序等。

## 2. 定址 ##

可以通过定址来定位所希望编辑的行，该地址用**数字**构成，用**逗号**分割的两个数表示以这两行为起止的行的范围(包括行数表示的那两行)。美元符号($)表示最后一行。范围可以通过数据，正则表达式或二者结合的方式确定。

## 3. Sed 命令 ##

调用 *Sed* 命令有两种形式：

		- sed [options] 'command' file(s)
		- sed [options] -f scriptfile file(s)

1. a\   在当前行后面加入一行文本。
2. b label   分支到脚本中带有标记的地方，如果分支不存在则分支到脚本的末尾。
3. c\   用新的文本改变本行的文本。
4. d    从模版块(Pattern Space)位置删除行。
5. D    删除莫板块的第一行。
6. i\   在当前行上面插入文本。
7. h    拷贝模版快的内容到内存中的缓冲区。
8. H    追加模版快的内容到内存中的缓冲区。
9. g    获得内存缓冲区的内容，并替代当前模版快中的文本。
10. G   获得内存缓冲区的内容，并追加到当前模版快文本的后面。
11. l   列表不能打印字符的清单。
12. n   读取下一个输入行，用下一个命令处理新的行而不是用第一个命令。
13. N   追缴下一个输入行到模版快后面，并在二者间嵌入一个新行，改变当前行号码。
14. p   打印模版快的行。
15. P   打印模版快的第一行。
16. q   退出 Sed。
17. r file   从 file 中读取行。
18. t label  if 分支，从最后一行开始，条件一旦满足或者 T,t命令，将导致分支到带有标号的命令出，或者到脚本的末尾。
19. T label  错误分支，从最后一行开始，一旦发生错误或者 T,t 命令，将导致分支到带有标号的命令处，或者到脚本的末尾。
20. w file   写并追加模版快到 file 末尾。
21. W file   写并追缴模版快的第一行到 file 末尾。
22. ！       表示后面的命令对所有没有被选定的行发生作用。
23. **s/re/string**  用 string 替换正则表达式 re。
24. =        打印当前行号。
25. #        注释，到洗衣歌换行符前。

**以下是替换标记：**

	- g 表示行全面替换。
	- p 表示打印行。
	- w 表示把行写入一个文件。
	- x 表示互换模版快中的文本和缓冲区中的文本。
	- y 表示把一个字符翻译为另外的字符(但是不用于正则表达式)。

## 4. 选项 ##

		-e command, --expression=command   允许多台编辑
		-h, --help                         打印帮助，并显示 bug 列表的地址。
		-n, --quiet, --slient              取消默认输出。
		-f, --filer=script-file            引导 sed 脚本文件名。
		-V, --version                      打印版本和版权信息。

## 5. 元字符集 ##

1. **^**   锚定行的开始。
2. **$**   锚定行的结束。
3. **.**   匹配一个任意非换行符的字符。
4. **\***  匹配零或多个字符。
5. **[]**  匹配一个指定范围内的字符。
6. **[^]** 匹配一个不在指定范围内的字符。
7. \(..\)  保存匹配的字符。
8.  &      保存搜索字符用来替换其他字符。
9. \<      锚定单词的开始。
10. \>     锚定单词的结束。
11. x\{m\} 重复字符 x, m 次。
12. x\{m，\} 重复字符至少 m 次。
13. x\{m，n} 重复字符 m --- n 次。

## 6. 实例 ##

1. 删除： **d 命令**

	- $sed '2d' example   删除 example 文件的第二行。
	- $sed '2,$d' example   删除 example 文件的第二行到末尾所有行。
	- $sed '$d' example   删除 example 文件的最后一行。
	- $sed '/test' d example   删除 example 文件所有包含 test 的行。

2. 替换： **s 命令**

	- $sed 's/test/mytest/g' example   在整个行范围内把 test 替换为 mytest。如果没有 g 标记，则只有每行第一个匹配的 test 被替换为 mytest。
	- $sed -n 's/test/mytest/p' example   -n 选项和 p 标志一起使用表示只打印那些发生替换的行。也就是说，如果某一行开头的 test 被替换为 mytest，就打印它。
	- $sed 's/^192.168.0.1/&localhost/' example   & 符号表示替换字符串中被找到的部分。所有以 192.168.0.1开头的行都被替换为**它自己加上localhost.**	
	- $sed -n 's/\(love\)able/\1rs/p' example   love被标记为 1。所有的 loveable 被替换为 lovers, 而且替换的行会被打印出来。
	- $sed 's#10#100#g' example   不论什么字符，紧跟着 s 命令的都被认为是新的分隔符，所以，“#” 在这里是分隔符，代替了默认的 “/” 分隔符。

3. 选定行的范围： **逗号**

	- $sed -n '/test/,/check/p' example   所有在模版 test 和 check 所确定的范围内的行都被打印。
	- $sed -n '5,/^test/p' example   打印从第五行开始到第一个包含以 test 开始的行之间的所有行。
	- $sed '/test/,/check/s/$/sed test/' example   对于模版 test 和 check 之间的行，每行的末尾用字符串 sed test 替换。

4. 多点编辑： **e 命令**

	- $sed -e '1,5d' -e 's/test/check/' example   -e 选项允许在同一行里执行多条命令。**命令的执行顺序对结果有影响。**
	- $sed --expression='s/test/check/' --expression='/love/d' example  

5. 从文件读入： **r 命令**

	- $sed '/test/r file' example   file 里的内容被读进来，显示在与 test 匹配的行的后面。如果匹配多行，则 file 的内容将显示在所有匹配行的下面。

6. 写入文件： **w 命令**

	- $sed -n '/test/w file' example   在 example 中所有包含 test 的行都被写入 file 里。

7. 追加命令： **a 命令**

	- $sed '/^test/a\\---> this is a example' example    sed 要求命令 a 后面有一个反斜杠。

8. 插入： **i 命令**

	- $sed '/test/i\\ text' example   如果 test 被匹配，则把反斜杠后面的文本插入到匹配行的前面。

9. 下一个： **n 命令**

	- $sed '/test/{n;s/aa/bb;}' example   如果 test 被匹配，则移动到匹配行的下一行，替换这一行的 aa 变为 bb，并打印该行，然后继续。

10. 变形： **y 命令**

	- $sed '1,10y/abcde/ABCDE/' example   把 1 --- 10 行所有的 abcde 转换为大写。注意：**正则表达式不能使用这个命令。**

11. 退出： **q 命令**

	- $sed '10 q' example   打印完第 10 行后，退出 sed。

12. 保持和获取： **h 命令和 G 命令**

	- $sed -e '/test/h' -e '$G' example   在 sed 处理文件时，每一行**都被保存在一个叫做模式空间的临时缓冲区中，**除非行被删除或者输出被取消，否则所有被处理的行都将打印到屏幕上。接着模式空间被清空，并存入新的一行等待处理。在该例子中，匹配 test 的行被找到后，将存入模式空间， h 命令将其幅值并存入一个称为**保持缓冲区**的特殊缓冲区内。第二条语句的意思是，当达到最后一行后， G 命令取出保持缓冲区中的行，然后把它放回模式空间中，且追加到现在已近存在于模式空间中的行的末尾。在这个例子中就是追加到最后一行。简单地说，**任何包含 test 的行都被复制并追加到该文件的末尾。**

13. 保持和互换： **h 命令和 x 命令**

	- $sed -e '/test/h' -e'/check/x' example   互换模式空间和保持缓冲区的内容。

## 7. 脚本 ##

**Sed 脚本**是一个*sed*的命令清单，启动 sed 时以 *-f* 选项引导脚本文件名。 Sed 对于脚本中的输入命令非常挑剔，**在命令的末尾不能有任何空白或文本，如果在一行中有多个命令，要用分号分割。**以 *#* 开头的行为注释行，且不能跨行。